(()=>{var J=Object.defineProperty;var q=(r,e)=>{for(var t in e)J(r,t,{get:e[t],enumerable:!0})};var A=function(){function r(e,t){this.eventTarget=e,this.eventName=t,this.unorderedBindings=new Set}return r.prototype.connect=function(){this.eventTarget.addEventListener(this.eventName,this,!1)},r.prototype.disconnect=function(){this.eventTarget.removeEventListener(this.eventName,this,!1)},r.prototype.bindingConnected=function(e){this.unorderedBindings.add(e)},r.prototype.bindingDisconnected=function(e){this.unorderedBindings.delete(e)},r.prototype.handleEvent=function(e){for(var t=G(e),n=0,o=this.bindings;n<o.length;n++){var i=o[n];if(t.immediatePropagationStopped)break;i.handleEvent(t)}},Object.defineProperty(r.prototype,"bindings",{get:function(){return Array.from(this.unorderedBindings).sort(function(e,t){var n=e.index,o=t.index;return n<o?-1:n>o?1:0})},enumerable:!0,configurable:!0}),r}();function G(r){if("immediatePropagationStopped"in r)return r;var e=r.stopImmediatePropagation;return Object.assign(r,{immediatePropagationStopped:!1,stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,e.call(this)}})}var T=function(){function r(e){this.application=e,this.eventListenerMaps=new Map,this.started=!1}return r.prototype.start=function(){this.started||(this.started=!0,this.eventListeners.forEach(function(e){return e.connect()}))},r.prototype.stop=function(){this.started&&(this.started=!1,this.eventListeners.forEach(function(e){return e.disconnect()}))},Object.defineProperty(r.prototype,"eventListeners",{get:function(){return Array.from(this.eventListenerMaps.values()).reduce(function(e,t){return e.concat(Array.from(t.values()))},[])},enumerable:!0,configurable:!0}),r.prototype.bindingConnected=function(e){this.fetchEventListenerForBinding(e).bindingConnected(e)},r.prototype.bindingDisconnected=function(e){this.fetchEventListenerForBinding(e).bindingDisconnected(e)},r.prototype.handleError=function(e,t,n){n===void 0&&(n={}),this.application.handleError(e,"Error "+t,n)},r.prototype.fetchEventListenerForBinding=function(e){var t=e.eventTarget,n=e.eventName;return this.fetchEventListener(t,n)},r.prototype.fetchEventListener=function(e,t){var n=this.fetchEventListenerMapForEventTarget(e),o=n.get(t);return o||(o=this.createEventListener(e,t),n.set(t,o)),o},r.prototype.createEventListener=function(e,t){var n=new A(e,t);return this.started&&n.connect(),n},r.prototype.fetchEventListenerMapForEventTarget=function(e){var t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t},r}();var Z=/^((.+?)(@(window|document))?->)?(.+?)(#(.+))?$/;function P(r){var e=r.trim(),t=e.match(Z)||[];return{eventTarget:$(t[4]),eventName:t[2],identifier:t[5],methodName:t[7]}}function $(r){if(r=="window")return window;if(r=="document")return document}function w(r){if(r==window)return"window";if(r==document)return"document"}var S=function(){function r(e,t,n){this.element=e,this.index=t,this.eventTarget=n.eventTarget||e,this.eventName=n.eventName||H(e)||y("missing event name"),this.identifier=n.identifier||y("missing identifier"),this.methodName=n.methodName||y("missing method name")}return r.forToken=function(e){return new this(e.element,e.index,P(e.content))},r.prototype.toString=function(){var e=this.eventTargetName?"@"+this.eventTargetName:"";return""+this.eventName+e+"->"+this.identifier+"#"+this.methodName},Object.defineProperty(r.prototype,"eventTargetName",{get:function(){return w(this.eventTarget)},enumerable:!0,configurable:!0}),r}();var B={a:function(r){return"click"},button:function(r){return"click"},form:function(r){return"submit"},input:function(r){return r.getAttribute("type")=="submit"?"click":"change"},select:function(r){return"change"},textarea:function(r){return"change"}};function H(r){var e=r.tagName.toLowerCase();if(e in B)return B[e](r)}function y(r){throw new Error(r)}var C=function(){function r(e,t){this.context=e,this.action=t}return Object.defineProperty(r.prototype,"index",{get:function(){return this.action.index},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"eventTarget",{get:function(){return this.action.eventTarget},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.context.identifier},enumerable:!0,configurable:!0}),r.prototype.handleEvent=function(e){this.willBeInvokedByEvent(e)&&this.invokeWithEvent(e)},Object.defineProperty(r.prototype,"eventName",{get:function(){return this.action.eventName},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"method",{get:function(){var e=this.controller[this.methodName];if(typeof e=="function")return e;throw new Error('Action "'+this.action+'" references undefined method "'+this.methodName+'"')},enumerable:!0,configurable:!0}),r.prototype.invokeWithEvent=function(e){try{this.method.call(this.controller,e)}catch(f){var t=this,n=t.identifier,o=t.controller,i=t.element,a=t.index,u={identifier:n,controller:o,element:i,index:a,event:e};this.context.handleError(f,'invoking action "'+this.action+'"',u)}},r.prototype.willBeInvokedByEvent=function(e){var t=e.target;return this.element===t?!0:t instanceof Element&&this.element.contains(t)?this.scope.containsElement(t):!0},Object.defineProperty(r.prototype,"controller",{get:function(){return this.context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"methodName",{get:function(){return this.action.methodName},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scope",{get:function(){return this.context.scope},enumerable:!0,configurable:!0}),r}();var k=function(){function r(e,t){var n=this;this.element=e,this.started=!1,this.delegate=t,this.elements=new Set,this.mutationObserver=new MutationObserver(function(o){return n.processMutations(o)})}return r.prototype.start=function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,childList:!0,subtree:!0}),this.refresh())},r.prototype.stop=function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)},r.prototype.refresh=function(){if(this.started){for(var e=new Set(this.matchElementsInTree()),t=0,n=Array.from(this.elements);t<n.length;t++){var o=n[t];e.has(o)||this.removeElement(o)}for(var i=0,a=Array.from(e);i<a.length;i++){var o=a[i];this.addElement(o)}}},r.prototype.processMutations=function(e){if(this.started)for(var t=0,n=e;t<n.length;t++){var o=n[t];this.processMutation(o)}},r.prototype.processMutation=function(e){e.type=="attributes"?this.processAttributeChange(e.target,e.attributeName):e.type=="childList"&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))},r.prototype.processAttributeChange=function(e,t){var n=e;this.elements.has(n)?this.delegate.elementAttributeChanged&&this.matchElement(n)?this.delegate.elementAttributeChanged(n,t):this.removeElement(n):this.matchElement(n)&&this.addElement(n)},r.prototype.processRemovedNodes=function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var o=n[t],i=this.elementFromNode(o);i&&this.processTree(i,this.removeElement)}},r.prototype.processAddedNodes=function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var o=n[t],i=this.elementFromNode(o);i&&this.elementIsActive(i)&&this.processTree(i,this.addElement)}},r.prototype.matchElement=function(e){return this.delegate.matchElement(e)},r.prototype.matchElementsInTree=function(e){return e===void 0&&(e=this.element),this.delegate.matchElementsInTree(e)},r.prototype.processTree=function(e,t){for(var n=0,o=this.matchElementsInTree(e);n<o.length;n++){var i=o[n];t.call(this,i)}},r.prototype.elementFromNode=function(e){if(e.nodeType==Node.ELEMENT_NODE)return e},r.prototype.elementIsActive=function(e){return e.isConnected!=this.element.isConnected?!1:this.element.contains(e)},r.prototype.addElement=function(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))},r.prototype.removeElement=function(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))},r}();var j=function(){function r(e,t,n){this.attributeName=t,this.delegate=n,this.elementObserver=new k(e,this)}return Object.defineProperty(r.prototype,"element",{get:function(){return this.elementObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selector",{get:function(){return"["+this.attributeName+"]"},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.elementObserver.start()},r.prototype.stop=function(){this.elementObserver.stop()},r.prototype.refresh=function(){this.elementObserver.refresh()},Object.defineProperty(r.prototype,"started",{get:function(){return this.elementObserver.started},enumerable:!0,configurable:!0}),r.prototype.matchElement=function(e){return e.hasAttribute(this.attributeName)},r.prototype.matchElementsInTree=function(e){var t=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(this.selector));return t.concat(n)},r.prototype.elementMatched=function(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)},r.prototype.elementUnmatched=function(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)},r.prototype.elementAttributeChanged=function(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)},r}();function p(r,e,t){F(r,e).add(t)}function h(r,e,t){F(r,e).delete(t),Q(r,e)}function F(r,e){var t=r.get(e);return t||(t=new Set,r.set(e,t)),t}function Q(r,e){var t=r.get(e);t!=null&&t.size==0&&r.delete(e)}var l=function(){function r(){this.valuesByKey=new Map}return Object.defineProperty(r.prototype,"values",{get:function(){var e=Array.from(this.valuesByKey.values());return e.reduce(function(t,n){return t.concat(Array.from(n))},[])},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){var e=Array.from(this.valuesByKey.values());return e.reduce(function(t,n){return t+n.size},0)},enumerable:!0,configurable:!0}),r.prototype.add=function(e,t){p(this.valuesByKey,e,t)},r.prototype.delete=function(e,t){h(this.valuesByKey,e,t)},r.prototype.has=function(e,t){var n=this.valuesByKey.get(e);return n!=null&&n.has(t)},r.prototype.hasKey=function(e){return this.valuesByKey.has(e)},r.prototype.hasValue=function(e){var t=Array.from(this.valuesByKey.values());return t.some(function(n){return n.has(e)})},r.prototype.getValuesForKey=function(e){var t=this.valuesByKey.get(e);return t?Array.from(t):[]},r.prototype.getKeysForValue=function(e){return Array.from(this.valuesByKey).filter(function(t){var n=t[0],o=t[1];return o.has(e)}).map(function(t){var n=t[0],o=t[1];return n})},r}();var X=function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Le=function(r){X(e,r);function e(){var t=r.call(this)||this;return t.keysByValue=new Map,t}return Object.defineProperty(e.prototype,"values",{get:function(){return Array.from(this.keysByValue.keys())},enumerable:!0,configurable:!0}),e.prototype.add=function(t,n){r.prototype.add.call(this,t,n),p(this.keysByValue,n,t)},e.prototype.delete=function(t,n){r.prototype.delete.call(this,t,n),h(this.keysByValue,n,t)},e.prototype.hasValue=function(t){return this.keysByValue.has(t)},e.prototype.getKeysForValue=function(t){var n=this.keysByValue.get(t);return n?Array.from(n):[]},e}(l);var L=function(){function r(e,t,n){this.attributeObserver=new j(e,t,this),this.delegate=n,this.tokensByElement=new l}return Object.defineProperty(r.prototype,"started",{get:function(){return this.attributeObserver.started},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.attributeObserver.start()},r.prototype.stop=function(){this.attributeObserver.stop()},r.prototype.refresh=function(){this.attributeObserver.refresh()},Object.defineProperty(r.prototype,"element",{get:function(){return this.attributeObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"attributeName",{get:function(){return this.attributeObserver.attributeName},enumerable:!0,configurable:!0}),r.prototype.elementMatchedAttribute=function(e){this.tokensMatched(this.readTokensForElement(e))},r.prototype.elementAttributeValueChanged=function(e){var t=this.refreshTokensForElement(e),n=t[0],o=t[1];this.tokensUnmatched(n),this.tokensMatched(o)},r.prototype.elementUnmatchedAttribute=function(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))},r.prototype.tokensMatched=function(e){var t=this;e.forEach(function(n){return t.tokenMatched(n)})},r.prototype.tokensUnmatched=function(e){var t=this;e.forEach(function(n){return t.tokenUnmatched(n)})},r.prototype.tokenMatched=function(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)},r.prototype.tokenUnmatched=function(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)},r.prototype.refreshTokensForElement=function(e){var t=this.tokensByElement.getValuesForKey(e),n=this.readTokensForElement(e),o=ee(t,n).findIndex(function(i){var a=i[0],u=i[1];return!te(a,u)});return o==-1?[[],[]]:[t.slice(o),n.slice(o)]},r.prototype.readTokensForElement=function(e){var t=this.attributeName,n=e.getAttribute(t)||"";return Y(n,e,t)},r}();function Y(r,e,t){return r.trim().split(/\s+/).filter(function(n){return n.length}).map(function(n,o){return{element:e,attributeName:t,content:n,index:o}})}function ee(r,e){var t=Math.max(r.length,e.length);return Array.from({length:t},function(n,o){return[r[o],e[o]]})}function te(r,e){return r&&e&&r.index==e.index&&r.content==e.content}var d=function(){function r(e,t,n){this.tokenListObserver=new L(e,t,this),this.delegate=n,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}return Object.defineProperty(r.prototype,"started",{get:function(){return this.tokenListObserver.started},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.tokenListObserver.start()},r.prototype.stop=function(){this.tokenListObserver.stop()},r.prototype.refresh=function(){this.tokenListObserver.refresh()},Object.defineProperty(r.prototype,"element",{get:function(){return this.tokenListObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"attributeName",{get:function(){return this.tokenListObserver.attributeName},enumerable:!0,configurable:!0}),r.prototype.tokenMatched=function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).set(e,n),this.delegate.elementMatchedValue(t,n))},r.prototype.tokenUnmatched=function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,n))},r.prototype.fetchParseResultForToken=function(e){var t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t},r.prototype.fetchValuesByTokenForElement=function(e){var t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t},r.prototype.parseToken=function(e){try{var t=this.delegate.parseValueForToken(e);return{value:t}}catch(n){return{error:n}}},r}();var M=function(){function r(e,t){this.context=e,this.delegate=t,this.bindingsByAction=new Map}return r.prototype.start=function(){this.valueListObserver||(this.valueListObserver=new d(this.element,this.actionAttribute,this),this.valueListObserver.start())},r.prototype.stop=function(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())},Object.defineProperty(r.prototype,"element",{get:function(){return this.context.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.context.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actionAttribute",{get:function(){return this.schema.actionAttribute},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"schema",{get:function(){return this.context.schema},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bindings",{get:function(){return Array.from(this.bindingsByAction.values())},enumerable:!0,configurable:!0}),r.prototype.connectAction=function(e){var t=new C(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)},r.prototype.disconnectAction=function(e){var t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))},r.prototype.disconnectAllActions=function(){var e=this;this.bindings.forEach(function(t){return e.delegate.bindingDisconnected(t)}),this.bindingsByAction.clear()},r.prototype.parseValueForToken=function(e){var t=S.forToken(e);if(t.identifier==this.identifier)return t},r.prototype.elementMatchedValue=function(e,t){this.connectAction(t)},r.prototype.elementUnmatchedValue=function(e,t){this.disconnectAction(t)},r}();var g=function(){function r(e,t){this.module=e,this.scope=t,this.controller=new e.controllerConstructor(this),this.bindingObserver=new M(this,this.dispatcher);try{this.controller.initialize()}catch(n){this.handleError(n,"initializing controller")}}return r.prototype.connect=function(){this.bindingObserver.start();try{this.controller.connect()}catch(e){this.handleError(e,"connecting controller")}},r.prototype.disconnect=function(){try{this.controller.disconnect()}catch(e){this.handleError(e,"disconnecting controller")}this.bindingObserver.stop()},Object.defineProperty(r.prototype,"application",{get:function(){return this.module.application},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.module.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"schema",{get:function(){return this.application.schema},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dispatcher",{get:function(){return this.application.dispatcher},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parentElement",{get:function(){return this.element.parentElement},enumerable:!0,configurable:!0}),r.prototype.handleError=function(e,t,n){n===void 0&&(n={});var o=this,i=o.identifier,a=o.controller,u=o.element;n=Object.assign({identifier:i,controller:a,element:u},n),this.application.handleError(e,"Error "+t,n)},r}();var re=function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function N(r){return{identifier:r.identifier,controllerConstructor:ne(r.controllerConstructor)}}function ne(r){var e=oe(r);return e.bless(),e}var oe=function(){function r(t){function n(){var o=this&&this instanceof n?this.constructor:void 0;return Reflect.construct(t,arguments,o)}return n.prototype=Object.create(t.prototype,{constructor:{value:n}}),Reflect.setPrototypeOf(n,t),n}function e(){var t=function(){this.a.call(this)},n=r(t);return n.prototype.a=function(){},new n}try{return e(),r}catch{return function(n){return function(o){re(i,o);function i(){return o!==null&&o.apply(this,arguments)||this}return i}(n)}}}();var I=function(){function r(e,t){this.application=e,this.definition=N(t),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}return Object.defineProperty(r.prototype,"identifier",{get:function(){return this.definition.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"controllerConstructor",{get:function(){return this.definition.controllerConstructor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contexts",{get:function(){return Array.from(this.connectedContexts)},enumerable:!0,configurable:!0}),r.prototype.connectContextForScope=function(e){var t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()},r.prototype.disconnectContextForScope=function(e){var t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())},r.prototype.fetchContextForScope=function(e){var t=this.contextsByScope.get(e);return t||(t=new g(this,e),this.contextsByScope.set(e,t)),t},r}();var V=function(){function r(e){this.scope=e}return Object.defineProperty(r.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),r.prototype.get=function(e){return e=this.getFormattedKey(e),this.element.getAttribute(e)},r.prototype.set=function(e,t){return e=this.getFormattedKey(e),this.element.setAttribute(e,t),this.get(e)},r.prototype.has=function(e){return e=this.getFormattedKey(e),this.element.hasAttribute(e)},r.prototype.delete=function(e){return this.has(e)?(e=this.getFormattedKey(e),this.element.removeAttribute(e),!0):!1},r.prototype.getFormattedKey=function(e){return"data-"+this.identifier+"-"+ie(e)},r}();function ie(r){return r.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function m(r,e){return"["+r+'~="'+e+'"]'}var D=function(){function r(e){this.scope=e}return Object.defineProperty(r.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"schema",{get:function(){return this.scope.schema},enumerable:!0,configurable:!0}),r.prototype.has=function(e){return this.find(e)!=null},r.prototype.find=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getSelectorForTargetNames(e);return this.scope.findElement(n)},r.prototype.findAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getSelectorForTargetNames(e);return this.scope.findAllElements(n)},r.prototype.getSelectorForTargetNames=function(e){var t=this;return e.map(function(n){return t.getSelectorForTargetName(n)}).join(", ")},r.prototype.getSelectorForTargetName=function(e){var t=this.identifier+"."+e;return m(this.schema.targetAttribute,t)},r}();var U=function(){function r(e,t,n){this.schema=e,this.identifier=t,this.element=n,this.targets=new D(this),this.data=new V(this)}return r.prototype.findElement=function(e){return this.findAllElements(e)[0]},r.prototype.findAllElements=function(e){var t=this.element.matches(e)?[this.element]:[],n=this.filterElements(Array.from(this.element.querySelectorAll(e)));return t.concat(n)},r.prototype.filterElements=function(e){var t=this;return e.filter(function(n){return t.containsElement(n)})},r.prototype.containsElement=function(e){return e.closest(this.controllerSelector)===this.element},Object.defineProperty(r.prototype,"controllerSelector",{get:function(){return m(this.schema.controllerAttribute,this.identifier)},enumerable:!0,configurable:!0}),r}();var K=function(){function r(e,t,n){this.element=e,this.schema=t,this.delegate=n,this.valueListObserver=new d(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}return r.prototype.start=function(){this.valueListObserver.start()},r.prototype.stop=function(){this.valueListObserver.stop()},Object.defineProperty(r.prototype,"controllerAttribute",{get:function(){return this.schema.controllerAttribute},enumerable:!0,configurable:!0}),r.prototype.parseValueForToken=function(e){var t=e.element,n=e.content,o=this.fetchScopesByIdentifierForElement(t),i=o.get(n);return i||(i=new U(this.schema,n,t),o.set(n,i)),i},r.prototype.elementMatchedValue=function(e,t){var n=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,n),n==1&&this.delegate.scopeConnected(t)},r.prototype.elementUnmatchedValue=function(e,t){var n=this.scopeReferenceCounts.get(t);n&&(this.scopeReferenceCounts.set(t,n-1),n==1&&this.delegate.scopeDisconnected(t))},r.prototype.fetchScopesByIdentifierForElement=function(e){var t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t},r}();var R=function(){function r(e){this.application=e,this.scopeObserver=new K(this.element,this.schema,this),this.scopesByIdentifier=new l,this.modulesByIdentifier=new Map}return Object.defineProperty(r.prototype,"element",{get:function(){return this.application.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"schema",{get:function(){return this.application.schema},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"controllerAttribute",{get:function(){return this.schema.controllerAttribute},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"modules",{get:function(){return Array.from(this.modulesByIdentifier.values())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contexts",{get:function(){return this.modules.reduce(function(e,t){return e.concat(t.contexts)},[])},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.scopeObserver.start()},r.prototype.stop=function(){this.scopeObserver.stop()},r.prototype.loadDefinition=function(e){this.unloadIdentifier(e.identifier);var t=new I(this.application,e);this.connectModule(t)},r.prototype.unloadIdentifier=function(e){var t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)},r.prototype.getContextForElementAndIdentifier=function(e,t){var n=this.modulesByIdentifier.get(t);if(n)return n.contexts.find(function(o){return o.element==e})},r.prototype.handleError=function(e,t,n){this.application.handleError(e,t,n)},r.prototype.scopeConnected=function(e){this.scopesByIdentifier.add(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)},r.prototype.scopeDisconnected=function(e){this.scopesByIdentifier.delete(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)},r.prototype.connectModule=function(e){this.modulesByIdentifier.set(e.identifier,e);var t=this.scopesByIdentifier.getValuesForKey(e.identifier);t.forEach(function(n){return e.connectContextForScope(n)})},r.prototype.disconnectModule=function(e){this.modulesByIdentifier.delete(e.identifier);var t=this.scopesByIdentifier.getValuesForKey(e.identifier);t.forEach(function(n){return e.disconnectContextForScope(n)})},r}();var v={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target"};var se=function(r,e,t,n){return new(t||(t=Promise))(function(o,i){function a(s){try{f(n.next(s))}catch(c){i(c)}}function u(s){try{f(n.throw(s))}catch(c){i(c)}}function f(s){s.done?o(s.value):new t(function(c){c(s.value)}).then(a,u)}f((n=n.apply(r,e||[])).next())})},ae=function(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(c){return f([s,c])}}function f(s){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=o[s[0]&2?"return":s[0]?"throw":"next"])&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return t.label++,{value:s[1],done:!1};case 5:t.label++,o=s[1],s=[0];continue;case 7:s=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){t.label=s[1];break}if(s[0]===6&&t.label<i[1]){t.label=i[1],i=s;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(s);break}i[2]&&t.ops.pop(),t.trys.pop();continue}s=e.call(r,t)}catch(c){s=[6,c],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},b=function(){function r(e,t){e===void 0&&(e=document.documentElement),t===void 0&&(t=v),this.element=e,this.schema=t,this.dispatcher=new T(this),this.router=new R(this)}return r.start=function(e,t){var n=new r(e,t);return n.start(),n},r.prototype.start=function(){return se(this,void 0,void 0,function(){return ae(this,function(e){switch(e.label){case 0:return[4,ue()];case 1:return e.sent(),this.router.start(),this.dispatcher.start(),[2]}})})},r.prototype.stop=function(){this.router.stop(),this.dispatcher.stop()},r.prototype.register=function(e,t){this.load({identifier:e,controllerConstructor:t})},r.prototype.load=function(e){for(var t=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=Array.isArray(e)?e:[e].concat(n);i.forEach(function(a){return t.router.loadDefinition(a)})},r.prototype.unload=function(e){for(var t=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=Array.isArray(e)?e:[e].concat(n);i.forEach(function(a){return t.router.unloadIdentifier(a)})},Object.defineProperty(r.prototype,"controllers",{get:function(){return this.router.contexts.map(function(e){return e.controller})},enumerable:!0,configurable:!0}),r.prototype.getControllerForElementAndIdentifier=function(e,t){var n=this.router.getContextForElementAndIdentifier(e,t);return n?n.controller:null},r.prototype.handleError=function(e,t,n){console.error(`%s

%o

%o`,t,e,n)},r}();function ue(){return new Promise(function(r){document.readyState=="loading"?document.addEventListener("DOMContentLoaded",r):r()})}function _(r){var e=r.prototype,t=ce(r);t.forEach(function(n){var o;return pe(e,(o={},o[n+"Target"]={get:function(){var i=this.targets.find(n);if(i)return i;throw new Error('Missing target element "'+this.identifier+"."+n+'"')}},o[n+"Targets"]={get:function(){return this.targets.findAll(n)}},o["has"+he(n)+"Target"]={get:function(){return this.targets.has(n)}},o))})}function ce(r){var e=fe(r);return Array.from(e.reduce(function(t,n){return le(n).forEach(function(o){return t.add(o)}),t},new Set))}function fe(r){for(var e=[];r;)e.push(r),r=Object.getPrototypeOf(r);return e}function le(r){var e=r.targets;return Array.isArray(e)?e:[]}function pe(r,e){Object.keys(e).forEach(function(t){if(!(t in r)){var n=e[t];Object.defineProperty(r,t,n)}})}function he(r){return r.charAt(0).toUpperCase()+r.slice(1)}var O=function(){function r(e){this.context=e}return r.bless=function(){_(this)},Object.defineProperty(r.prototype,"application",{get:function(){return this.context.application},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scope",{get:function(){return this.context.scope},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"targets",{get:function(){return this.scope.targets},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"data",{get:function(){return this.scope.data},enumerable:!0,configurable:!0}),r.prototype.initialize=function(){},r.prototype.connect=function(){},r.prototype.disconnect=function(){},r.targets=[],r}();function de(r,e){return[...new Set(r.split("--").filter(n=>!["..",e].includes(n)))].join("--")}function z(r,e,t){e.forEach(n=>{r.register(de(n.name,t),n.module.default)})}var x={};q(x,{default:()=>E});var E=class extends O{static targets=["rootDiv","filesField","filesList","uploadingSpan","finishedSpan","failedSpan"];getUploadUrlAndUpload(r){this.inProgress();var e=r.srcElement,t=e.files[0],n=new FormData;n.append("filename",t.name);let o=this.rootDivTarget.dataset.generatePresignedUrlPath;fetch(o,{method:"POST",body:n}).then(i=>i.json()).then(i=>{this.upload(i,e,t.name)})}upload(r,e,t){var n=new FormData;for(let[i,a]of Object.entries(r.upload_params))n.append(i,a);var o=e.files[0];n.append("file",o),fetch(r.url,{method:"POST",body:n}).then(i=>{i.status===201?(this.addToForm(r,t),this.addToList(t,this.getUrl(r))):this.failedProgress()}).catch(i=>{this.failedProgress()})}addToForm(r,e){let t=JSON.parse(this.filesFieldTarget.value);t.push({filename:e,url:this.getUrl(r)}),this.filesFieldTarget.value=JSON.stringify(t),this.completedProgress()}addToList(r,e){var t=document.createElement("li"),n=document.createElement("a"),o=document.createElement("a");n.textContent=r,n.classList.add("text-blue-600"),n.classList.add("hover:underline"),n.href=e,o.dataset.action="click->s3-direct-upload#deleteAttachment",o.textContent="Delete",o.classList.add("text-red-600","ml-4","hover:underline"),t.appendChild(n),t.appendChild(o),this.filesListTarget.appendChild(t)}getUrl(r){return r.url+"/"+r.upload_params.key}deleteAttachment(r){let e=r.target.parentElement.children[0].innerText,t=JSON.parse(this.filesFieldTarget.value);if(!confirm("Are you sure you want to delete "+e+"?"))return;var n=[];for(let i of t)i.filename!=e&&n.push(i);this.filesFieldTarget.value=JSON.stringify(n);let o=r.target.dataset.destroyUrl;this.inProgress(),o!=null?fetch(o,{method:"DELETE"}).then(i=>{i.status===200?(r.target.parentElement.remove(),this.completedProgress()):this.failedProgress()}):(r.target.parentElement.remove(),this.completedProgress())}inProgress(){this.finishedSpanTarget.hidden=!0,this.failedSpanTarget.hidden=!0,this.uploadingSpanTarget.hidden=!1}failedProgress(){this.uploadingSpanTarget.hidden=!0,this.finishedSpanTarget.hidden=!0,this.failedSpanTarget.hidden=!1}completedProgress(){this.uploadingSpanTarget.hidden=!0,this.failedSpanTarget.hidden=!0,this.finishedSpanTarget.hidden=!1}};var me=[{name:"shared-controllers--s3-direct-upload",module:x,filename:"./shared_controllers/s3_direct_upload_controller.js"}],W=me;var ye=b.start();z(ye,W,"shared-controllers");})();
