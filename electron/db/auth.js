(function(_0xdd519f,_0x12867f){const _0x5adf60=a0_0x2192,_0x4b6b8e=_0xdd519f();while(!![]){try{const _0x4c42c9=-parseInt(_0x5adf60(0x116))/0x1+parseInt(_0x5adf60(0x117))/0x2*(parseInt(_0x5adf60(0x11b))/0x3)+-parseInt(_0x5adf60(0x107))/0x4+-parseInt(_0x5adf60(0x11c))/0x5*(-parseInt(_0x5adf60(0x126))/0x6)+parseInt(_0x5adf60(0x129))/0x7+parseInt(_0x5adf60(0x111))/0x8+parseInt(_0x5adf60(0x10d))/0x9*(-parseInt(_0x5adf60(0x11f))/0xa);if(_0x4c42c9===_0x12867f)break;else _0x4b6b8e['push'](_0x4b6b8e['shift']());}catch(_0x3a6f0e){_0x4b6b8e['push'](_0x4b6b8e['shift']());}}}(a0_0x33bc,0x55d1c));function a0_0x2192(_0x455e8c,_0x52f3d4){_0x455e8c=_0x455e8c-0x105;const _0x3542bb=a0_0x33bc();let _0x10a3f6=_0x3542bb[_0x455e8c];return _0x10a3f6;}const a0_0x30210b=(function(){let _0x2a998f=!![];return function(_0xb3d669,_0x548aa8){const _0x3ba20e=_0x2a998f?function(){const _0x412a65=a0_0x2192;if(_0x548aa8){const _0x2e35af=_0x548aa8[_0x412a65(0x12c)](_0xb3d669,arguments);return _0x548aa8=null,_0x2e35af;}}:function(){};return _0x2a998f=![],_0x3ba20e;};}()),a0_0x10a3f6=a0_0x30210b(this,function(){const _0x431920=a0_0x2192;return a0_0x10a3f6[_0x431920(0x128)]()[_0x431920(0x118)](_0x431920(0x127))[_0x431920(0x128)]()[_0x431920(0x122)](a0_0x10a3f6)[_0x431920(0x118)](_0x431920(0x127));});a0_0x10a3f6();import{ipcMain}from'electron';function a0_0x33bc(){const _0x4b82d5=['where','Failed\x20to\x20create\x20user:','Login\x20error:','226530WmUBcr','auth:get-users','auth:get-current-user','values','3929264MBKroJ','username','handle','Failed\x20to\x20get\x20users:','message','483875ihkMVS','2vhLczo','search','auth:logout','select','1294206HMWOUy','1552840jSMsUG','role','Invalid\x20username\x20or\x20password','40wOUcNp','compare','error','constructor','from','delete','createdAt','6KBMoef','(((.+)+)+)+$','toString','1428126WhEFCu','passwordHash','auth:create-user','apply','hash','auth:delete-user','2004300LHaOTY','USER-','insert'];a0_0x33bc=function(){return _0x4b82d5;};return a0_0x33bc();}import a0_0x7027f2 from'bcryptjs';import{db}from'./index.js';import{users}from'./schema.js';import{eq}from'drizzle-orm';let currentUser=null;export function setupAuthHandlers(){const _0x267388=a0_0x2192;ipcMain[_0x267388(0x113)]('auth:login',async(_0x2cae70,{username:_0x1fd1ed,password:_0x202e82})=>{const _0x346c1f=_0x267388;try{const _0x5d9d58=await db['select']()['from'](users)[_0x346c1f(0x10a)](eq(users[_0x346c1f(0x112)],_0x1fd1ed))['get']();if(!_0x5d9d58)return{'success':![],'message':_0x346c1f(0x11e)};const _0xfabcca=await a0_0x7027f2[_0x346c1f(0x120)](_0x202e82,_0x5d9d58[_0x346c1f(0x12a)]);if(!_0xfabcca)return{'success':![],'message':'Invalid\x20username\x20or\x20password'};const {passwordHash:_0x46358e,..._0x5f1711}=_0x5d9d58;return currentUser=_0x5f1711,{'success':!![],'user':_0x5f1711};}catch(_0x28af5f){return console[_0x346c1f(0x121)](_0x346c1f(0x10c),_0x28af5f),{'success':![],'message':'An\x20error\x20occurred\x20during\x20login'};}}),ipcMain[_0x267388(0x113)](_0x267388(0x10f),()=>{return currentUser;}),ipcMain[_0x267388(0x113)](_0x267388(0x119),()=>{return currentUser=null,{'success':!![]};}),ipcMain[_0x267388(0x113)](_0x267388(0x10e),async()=>{const _0x603e3b=_0x267388;try{const _0x43bf53=await db[_0x603e3b(0x11a)]({'id':users['id'],'username':users[_0x603e3b(0x112)],'role':users[_0x603e3b(0x11d)],'createdAt':users[_0x603e3b(0x125)]})[_0x603e3b(0x123)](users)['all']();return _0x43bf53;}catch(_0x399301){return console[_0x603e3b(0x121)](_0x603e3b(0x114),_0x399301),[];}}),ipcMain[_0x267388(0x113)](_0x267388(0x12b),async(_0x42dbb6,{username:_0x4ee1d1,password:_0x2d8fb0,role:_0x2c29a5})=>{const _0x3e43b3=_0x267388;try{const _0x5d1a4c=await a0_0x7027f2['genSalt'](0xa),_0x44866b=await a0_0x7027f2[_0x3e43b3(0x105)](_0x2d8fb0,_0x5d1a4c);return await db[_0x3e43b3(0x109)](users)[_0x3e43b3(0x110)]({'id':_0x3e43b3(0x108)+Date['now'](),'username':_0x4ee1d1,'passwordHash':_0x44866b,'role':_0x2c29a5}),{'success':!![]};}catch(_0x228773){return console[_0x3e43b3(0x121)](_0x3e43b3(0x10b),_0x228773),{'success':![],'message':_0x228773[_0x3e43b3(0x115)]};}}),ipcMain['handle'](_0x267388(0x106),async(_0x4074c8,_0x230ef9)=>{const _0x359010=_0x267388;try{return await db[_0x359010(0x124)](users)[_0x359010(0x10a)](eq(users['id'],_0x230ef9)),{'success':!![]};}catch(_0x61eba8){return console[_0x359010(0x121)]('Failed\x20to\x20delete\x20user:',_0x61eba8),{'success':![],'message':_0x61eba8[_0x359010(0x115)]};}});}export{currentUser};